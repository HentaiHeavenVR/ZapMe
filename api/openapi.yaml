openapi: 3.0.1
info:
  title: ZapMe
  description: Open source application to control things
  termsOfService: https://heavenvr.tech/tos
  contact:
    name: Contact me
    url: https://heavenvr.tech/contact
  license:
    name: 'The Apache License, Version 2.0'
    url: https://heavenvr.tech/license
  version: v1
paths:
  /api/v1/account:
    post:
      tags:
        - Account
      summary: Create a new account
      operationId: CreateAccount
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Create'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
        '400':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
    delete:
      tags:
        - Account
      summary: Delete currently logged in account
      operationId: DeleteAccount
      parameters:
        - name: Authorization
          in: header
          schema:
            type: string
        - name: reason
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
    get:
      tags:
        - Account
      summary: ''
      operationId: GetAccount
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
  '/api/v1/account/oauth/{providerName}':
    post:
      tags:
        - Account
      summary: Add a oauth connection to account
      operationId: AddOAuthProvider
      parameters:
        - name: providerName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountOAuthAdd'
      responses:
        '200':
          description: Success
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
    delete:
      tags:
        - Account
      summary: Remove a oauth connection from account
      operationId: RemoveOAuthProvider
      parameters:
        - name: providerName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
        '404':
          description: Not Found
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            text/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  /api/v1/account/recover:
    post:
      tags:
        - Account
      summary: 'Request password recovery of a account, will send recovery secret to email'
      operationId: AccountRecoveryInit
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Recover'
          text/json:
            schema:
              $ref: '#/components/schemas/Recover'
          application/*+json:
            schema:
              $ref: '#/components/schemas/Recover'
      responses:
        '200':
          description: ''
  /api/v1/account/recover/complete:
    post:
      tags:
        - Account
      summary: Complete the recovery of a account using the received recovery secret
      operationId: AccountRecoveryComplete
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecoverComplete'
          text/json:
            schema:
              $ref: '#/components/schemas/RecoverComplete'
          application/*+json:
            schema:
              $ref: '#/components/schemas/RecoverComplete'
      responses:
        '200':
          description: ''
        '404':
          description: Not Found
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            text/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  /api/v1/account/email:
    put:
      tags:
        - Account
      summary: Updates the account email
      operationId: UpdateEmail
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmail'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
  /api/v1/account/password:
    put:
      tags:
        - Account
      summary: Updates the account password
      operationId: UpdatePassword
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePassword'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
  /api/v1/account/username:
    put:
      tags:
        - Account
      summary: Updates the account username
      operationId: UpdateUserName
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserName'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
  /api/v1/auth/signin:
    post:
      tags:
        - Authentication
      summary: ''
      operationId: AuthSignIn
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthSignIn'
          text/json:
            schema:
              $ref: '#/components/schemas/AuthSignIn'
          application/*+json:
            schema:
              $ref: '#/components/schemas/AuthSignIn'
      responses:
        '200':
          description: Returns users account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
        '400':
          description: ''
  /api/v1/auth/signin-oauth:
    post:
      tags:
        - Authentication
      summary: ''
      operationId: AuthSignInOAuth
      parameters:
        - name: provider
          in: query
          description: ''
          schema:
            type: string
      responses:
        '200':
          description: Returns users account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDto'
        '403':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '401':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  /api/v1/auth/signout:
    post:
      tags:
        - Authentication
      summary: ''
      operationId: AuthSignOut
      responses:
        '200':
          description: ''
  '/api/v1/errors/{errorId}':
    get:
      tags:
        - Errors
      summary: ''
      operationId: GetErrorDetails
      parameters:
        - name: errorId
          in: path
          description: ''
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDetails'
  /api/v1/errors:
    get:
      tags:
        - Errors
      summary: ''
      operationId: ListErrorDetails
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/ErrorDetails'
  /api/v1/health:
    get:
      tags:
        - Health
      summary: ''
      operationId: GetHealth
      responses:
        '200':
          description: ''
  '/api/v1/user/i/{userId}/friendrequest':
    put:
      tags:
        - User
      summary: Accept incoming friend request
      operationId: AcceptFriendRequest
      parameters:
        - name: userId
          in: path
          description: ''
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '304':
          description: Not Modified
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    delete:
      tags:
        - User
      summary: Delete outgoing/Reject incoming friend request
      operationId: DenyFriendRequest
      parameters:
        - name: userId
          in: path
          description: ''
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Success
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
    post:
      tags:
        - User
      summary: Send friend request
      operationId: SendFriendRequest
      parameters:
        - name: userId
          in: path
          description: ''
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Success
  /api/v1/user/friendrequests:
    get:
      tags:
        - User
      summary: List all incoming and outgoing friend requests
      operationId: ListFriendRequests
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FriendRequestList'
  '/api/v1/user/i/{userId}':
    get:
      tags:
        - User
      summary: Get user
      operationId: GetUser
      parameters:
        - name: userId
          in: path
          description: ''
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  '/api/v1/user/u/{userName}':
    get:
      tags:
        - User
      summary: Look up user by name
      operationId: LookUpUser
      parameters:
        - name: userName
          in: path
          description: ''
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  '/api/v1/user/i/{userId}/report':
    post:
      tags:
        - User
      summary: Report a user
      operationId: ReportUser
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserReport'
      responses:
        '200':
          description: ''
        '404':
          description: Not Found
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            text/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  /ws:
    get:
      tags:
        - WebSocket
      summary: "Websocket endpoint for pub/sub communication (e.g. chat, notifications, events)\r\n\r\nDocumentation:\r\nYes"
      responses:
        '200':
          description: Connection closed
        '400':
          description: This endpoint is purely just a websocket endpoint
components:
  schemas:
    AccountDto:
      type: object
      properties:
        id:
          type: string
          description: ''
          format: uuid
        username:
          type: string
          description: ''
        email:
          type: string
          description: Obfuscated email of your account
        email_verified:
          type: boolean
          description: True if email address has been verified
        connected_accounts:
          type: array
          items:
            type: string
          description: OAuth2 providers this account is connected to
        friends:
          type: array
          items:
            type: string
            format: uuid
          description: Id of friends this account has
        created_at:
          type: string
          description: Date this account was created at
          format: date-time
      additionalProperties: false
      description: 'Account object, this can only retrieved for the user you are logged in as'
    AccountOAuthAdd:
      type: object
      properties:
        oauth_code:
          type: string
      additionalProperties: false
      description: Request sent to server to add a oauth connection to a account
    AuthSignIn:
      type: object
      properties:
        username:
          maxLength: 32
          minLength: 3
          type: string
          description: ''
        password:
          maxLength: 256
          minLength: 10
          type: string
          description: ''
      additionalProperties: false
      description: Message sent to server to authenticate user using username and password
    ClientAction:
      enum:
        - none
        - retry
        - logOut
        - promptUserToContactSupport
        - panic
      type: string
      description: ''
    Create:
      type: object
      properties:
        username:
          maxLength: 32
          minLength: 3
          type: string
          description: ''
        password:
          maxLength: 256
          minLength: 10
          type: string
          description: ''
        email:
          type: string
          description: ''
          format: email
        acceptedTosVersion:
          type: integer
          description: ''
          format: int32
        recaptcha_response:
          type: string
          description: Response from google recaptcha request
      additionalProperties: false
      description: Message sent to server to create a new account
    ErrorDetails:
      type: object
      properties:
        title:
          type: string
          description: Title for developer to understand what went wrong (not user friendly)
        meaning:
          type: string
          description: More detailed description of what this error is about (not user friendly)
        suggestion:
          type: string
          description: Suggestion to developer on how they might be able to midegate this problem
        recommendedAction:
          $ref: '#/components/schemas/ClientAction'
        notification:
          $ref: '#/components/schemas/SystemNotification'
        link:
          type: string
          description: If applicable this can contain a link to more useful information for the developer
        image:
          type: string
          description: 'Funny image, feel free to display to user :3'
      additionalProperties: false
      description: Details about the error
    FriendRequestList:
      type: object
      properties:
        incoming:
          type: array
          items:
            type: string
            format: uuid
          description: UserId's of users that has sent friend requests to this account
        outgoing:
          type: array
          items:
            type: string
            format: uuid
          description: UserId's of users that this account has sent friend requests to
      additionalProperties: false
      description: List of incoming and outgoing friendrequests
    ProblemDetails:
      type: object
      properties:
        type:
          type: string
          nullable: true
        title:
          type: string
          nullable: true
        status:
          type: integer
          format: int32
          nullable: true
        detail:
          type: string
          nullable: true
        instance:
          type: string
          nullable: true
      additionalProperties: { }
    Recover:
      type: object
      properties:
        email:
          type: string
          description: Email of your account you want to recover
          format: email
        recaptcha_response:
          type: string
          description: Response from google recaptcha request
      additionalProperties: false
      description: Request sent to server to request a password recovery for account
    RecoverComplete:
      type: object
      properties:
        new_password:
          maxLength: 256
          minLength: 10
          type: string
          description: ''
          nullable: true
        recovery_secret:
          type: string
          description: The secret associated with this recovery request
      additionalProperties: false
      description: Request sent to server to complete a password recovery flow
    SeverityLevel:
      enum:
        - info
        - warning
        - error
      type: string
    SystemNotification:
      type: object
      properties:
        severity:
          $ref: '#/components/schemas/SeverityLevel'
        title:
          type: string
          description: Message title to display to the user
        description:
          type: string
          description: A user friendly description of this notification
      additionalProperties: false
      description: "System notification to be displayed to the user, do not confuse with user notifications\r\nThis is a hint and clients can choose to ignore it or implement notifications to be independent of this"
    UpdateEmail:
      type: object
      properties:
        new_email:
          type: string
          description: ''
          format: email
        password:
          type: string
          description: ''
      additionalProperties: false
      description: Request sent to server to update account email address
    UpdatePassword:
      type: object
      properties:
        new:
          maxLength: 256
          minLength: 10
          type: string
          description: ''
        old:
          type: string
          description: ''
      additionalProperties: false
      description: Request sent to server to update account password
    UpdateUserName:
      type: object
      properties:
        new_username:
          maxLength: 32
          minLength: 3
          type: string
          description: ''
        password:
          type: string
          description: ''
      additionalProperties: false
      description: Request sent to server to update account username
    User:
      type: object
      properties:
        id:
          type: string
          description: ''
          format: uuid
        username:
          type: string
          description: ''
        last_online:
          type: string
          description: Last time this user was online
          format: date-time
        created_at:
          type: string
          description: Date this account was created at
          format: date-time
      additionalProperties: false
      description: 'User object, this can be retrieved by anyone who is friends with the user'
    UserReport:
      type: object
      properties:
        title:
          type: string
          description: ''
        explenation:
          type: string
          description: ''
      additionalProperties: false
      description: Message sent to server to report a user